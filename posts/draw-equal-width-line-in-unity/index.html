<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>åœ¨Unityä¸­ç»˜åˆ¶ç­‰å®½çº¿æ¡ | ZZNEWCLEAR13</title><meta name=keywords content="Space Transformation,Anti-Aliasing"><meta name=description content="åœ¨Unityä¸–ç•Œç©ºé—´ä¸­ç”»ä¸€æ¡ç­‰å®½ä¸”æŠ—é”¯é½¿çš„ç›´çº¿."><meta name=author content="zznewclear13"><link rel=canonical href=https://zznewclear13.github.io/posts/draw-equal-width-line-in-unity/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://zznewclear13.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zznewclear13.github.io/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://zznewclear13.github.io/favicon.ico><link rel=apple-touch-icon href=https://zznewclear13.github.io/favicon.ico><link rel=mask-icon href=https://zznewclear13.github.io/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-157509723-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="åœ¨Unityä¸­ç»˜åˆ¶ç­‰å®½çº¿æ¡"><meta property="og:description" content="åœ¨Unityä¸–ç•Œç©ºé—´ä¸­ç”»ä¸€æ¡ç­‰å®½ä¸”æŠ—é”¯é½¿çš„ç›´çº¿."><meta property="og:type" content="article"><meta property="og:url" content="https://zznewclear13.github.io/posts/draw-equal-width-line-in-unity/"><meta property="og:image" content="https://zznewclear13.github.io/posts/draw-equal-width-line-in-unity/posts/images/EqualWidthLine.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-02T17:00:00+08:00"><meta property="article:modified_time" content="2021-12-02T17:00:00+08:00"><meta property="og:site_name" content="ZZNEWCLEAR13"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zznewclear13.github.io/posts/draw-equal-width-line-in-unity/posts/images/EqualWidthLine.jpg"><meta name=twitter:title content="åœ¨Unityä¸­ç»˜åˆ¶ç­‰å®½çº¿æ¡"><meta name=twitter:description content="åœ¨Unityä¸–ç•Œç©ºé—´ä¸­ç”»ä¸€æ¡ç­‰å®½ä¸”æŠ—é”¯é½¿çš„ç›´çº¿."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zznewclear13.github.io/posts/"},{"@type":"ListItem","position":2,"name":"åœ¨Unityä¸­ç»˜åˆ¶ç­‰å®½çº¿æ¡","item":"https://zznewclear13.github.io/posts/draw-equal-width-line-in-unity/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"åœ¨Unityä¸­ç»˜åˆ¶ç­‰å®½çº¿æ¡","name":"åœ¨Unityä¸­ç»˜åˆ¶ç­‰å®½çº¿æ¡","description":"åœ¨Unityä¸–ç•Œç©ºé—´ä¸­ç”»ä¸€æ¡ç­‰å®½ä¸”æŠ—é”¯é½¿çš„ç›´çº¿.","keywords":["Space Transformation","Anti-Aliasing"],"articleBody":"åŠ¨æœº ç›´æ¥åŠ¨æœºæ˜¯æƒ³è¦åœ¨unityä¸­åˆ¶ä½œä¸€ä¸ªæè¾¹æ•ˆæœã€‚å¯¹äºå¡é€šæ¸²æŸ“çš„æè¾¹æ•ˆæœï¼Œå·²ç»æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ¡ˆä¾‹äº†ï¼Œä½†æ˜¯æˆ‘è§‰å¾—è¿™äº›æ¡ˆä¾‹ä¸ä¸€å®šèƒ½å®Œå…¨æ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼Œäºæ˜¯æƒ³è¦ä»ç”»ç›´çº¿å¼€å§‹ç ”ç©¶ã€‚\nä»æ™®é€šç»˜ç”»çš„è§’åº¦æ¥çœ‹ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯æè¾¹çš„å®½åº¦åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼šè€ƒè™‘ä¸€ä¸‹è¿œæ™¯çš„ç‰©ä½“ï¼Œç”»å®¶åœ¨ç»˜ç”»çš„æ—¶å€™ä½¿ç”¨å’Œè¿‘æ™¯ç›¸åŒç²—ç»†çš„ç¬”ï¼ˆç”¨ä¸€æ ·æˆ–è€…ç¨å¼±çš„åŠ›ï¼‰ï¼Œç»˜åˆ¶ä¸€ä¸ªè¾ƒä¸ç²¾ç»†çš„ç‰©ä½“ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¾ˆç»†çš„ç¬”å»ç»˜åˆ¶ä¸€ä¸ªç²¾ç»†çš„ç‰©ä½“ï¼Œç»“è®ºå°±æ˜¯è¿œå¤„çš„æè¾¹å¯èƒ½ç¨ç»†ä¸€äº›ï¼Œä½†æœ€å¥½æ˜¯ç›¸åŒç²—ç»†ï¼Œå…¶é¢œè‰²å¯èƒ½ä¼šå˜æµ…ã€‚\nä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œæè¾¹å¾€å¾€éœ€è¦èƒ½å¤Ÿæ§åˆ¶å…¶å®½åº¦ï¼Œå¯¹äºè¾ƒç»†çš„çº¿ï¼Œåˆ™ä¼šæœ‰è¾ƒæ˜æ˜¾çš„é”¯é½¿ï¼ˆäº‹å®ä¸Šåªè¦è§’åº¦ä¸å¤ªå¥½çš„æè¾¹ï¼Œå°±ä¼šæœ‰å¾ˆæ˜æ˜¾çš„è¾¹ç¼˜é”¯é½¿ï¼‰ï¼Œé‚£ä¹ˆæ§åˆ¶ç²—ç»†å’Œè¿›è¡Œä¸€å®šç¨‹åº¦çš„æŠ—é”¯é½¿ä¹Ÿæ˜¯ä¸€ä¸ªç ”ç©¶çš„æ–¹å‘ã€‚\nä»ç¬¬ä¸‰ä¸ªè§’åº¦ï¼Œç¢°å·§çœ‹åˆ°äº†Freya HolmÃ©råˆ¶ä½œçš„Shapesæ’ä»¶ï¼Œèƒ½å¤Ÿç»˜åˆ¶é«˜è´¨é‡çš„çº¿æ¡ç”»ï¼Œçœ‹ä¸Šå»æ¸²æŸ“çš„æ•ˆæœå¾ˆå¥½ã€‚ä½†æ˜¯ä»·æ ¼è¿‡äºé«˜æ˜‚ï¼Œäºæ˜¯æƒ³è¦ç ”ç©¶ä¸€ä¸ªèƒ½å¤Ÿåšåˆ°å·®ä¸å¤šæ•ˆæœçš„å·¥å…·ã€‚\næŠ—é”¯é½¿å’Œå®½åº¦çš„æ€è€ƒ åœ¨Unityä¸­ç”»ç›´çº¿æœ‰è›®å¤šåŠæ³•ï¼ŒDebug.DrawLineæˆ–è€…Gizmos.DrawLineéƒ½èƒ½ç»˜åˆ¶ç­‰å®½çš„ç›´çº¿ï¼Œä¸è¿‡åªèƒ½å›ºå®šä¸€ä¸ªåƒç´ å®½ï¼Œè€Œä¸”å› ä¸ºåªæœ‰ä¸€ä¸ªåƒç´ å®½ï¼Œæ‰€ä»¥ä¼šæœ‰æ˜æ˜¾çš„é”¯é½¿ã€‚ä½¿ç”¨LineRendererå¯ä»¥ç»˜åˆ¶ä»»æ„å®½åº¦çš„ç›´çº¿ï¼Œå†™ç‰¹å®šçš„shaderé€šè¿‡é€æ˜åº¦æ··åˆèƒ½å¤Ÿé˜²æ­¢é”¯é½¿çš„å‡ºç°ï¼ˆä¸è¿‡çº¿æ®µä¸¤ç«¯ä¸å¤ªå¥½åšæŠ—é”¯é½¿ï¼‰ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åœ¨ä¸åŒè§’åº¦ä¸‹ç›´çº¿çš„å®½åº¦ç›¸ç­‰ã€‚é‚£ä¹ˆç­”æ¡ˆå°±å¾ˆæ˜æ˜¾äº†ï¼Œé€šè¿‡çº¿æ®µçš„é¡¶ç‚¹çš„æ•°æ®ï¼Œç”Ÿæˆä¸¤ä¸ªä¸‰è§’é¢ï¼ˆä¸€ä¸ªQuadï¼‰ï¼Œåœ¨GPUä¸­è®¡ç®—å‡ºä¸‰è§’é¢æ¯ä¸ªé¡¶ç‚¹çš„å±å¹•ç©ºé—´çš„ä½ç½®ï¼Œç¡®ä¿çº¿æ®µçš„å®½åº¦ä¸€è‡´ã€‚ä¹Ÿç”±äºæœ‰å®½åº¦çš„å­˜åœ¨ï¼Œç»™åç»­çš„é€æ˜åº¦æ··åˆæŠ—é”¯é½¿ç•™ä¸‹äº†æ“ä½œçš„ç©ºé—´ã€‚\nå…·ä½“çš„ç»˜åˆ¶çº¿æ¡çš„æ“ä½œ é¦–å…ˆçœ‹ä¸€å¼ å›¾ï¼ˆå®Œäº†ä¸‰è§’å½¢é¡¶ç‚¹é¡ºåºç”»åäº†ï¼Œå·²ç»ç§¯é‡éš¾è¿”äº†ï¼Œä»£ç è¡¨ç°å¯¹å°±å½“åšå¯¹çš„å§ï¼‰ æˆ‘ä»¬å°†ä½¿ç”¨Graphics.DrawProceduralè¿™ä¸ªæ–¹æ³•æ¥ç»˜åˆ¶æˆ‘ä»¬çš„ç›´çº¿ï¼Œæ¯ä¸€æ®µç›´çº¿ç”±ä¸¤ä¸ªä¸‰è§’å½¢ç»„æˆï¼ˆè¿™é‡Œè¦æ³¨æ„åœ¨unityä¸­ä¸‰è§’å½¢é¡¶ç‚¹é¡ºåºæ˜¯é¡ºæ—¶é’ˆçš„ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ç»˜åˆ¶Næ¡ç›´çº¿çš„è¯ï¼Œè¦ä¼ å…¥N+1ä¸ªèŠ‚ç‚¹ä½ç½®æ•°æ®ï¼Œè€Œå®é™…ç»˜åˆ¶æ—¶ä¼šç»˜åˆ¶6Nä¸ªé¡¶ç‚¹ã€‚è¿™æ ·ä¼ å…¥Shaderçš„æ˜¯ä¸€ä¸ªè¡¨ç¤ºçº¿æ®µèŠ‚ç‚¹ä½ç½®çš„é•¿åº¦æ˜¯N+1çš„Vector3æ•°æ®_VerticesBufferï¼Œå’Œä¸€ä¸ªè¡¨ç¤ºé¡¶ç‚¹åºå·çš„ä»0åˆ°6N-1çš„uintæ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨ç»˜åˆ¶æ—¶å›¾å½¢APIè‡ªåŠ¨ä¼ è¾“çš„SV_VERTEXIDã€‚\nè¿™ä¹Ÿå°±å¯¼è‡´äº†æˆ‘ä»¬çš„é¡¶ç‚¹ç€è‰²å™¨è¾“å…¥æ•°æ®å’Œæ™®é€šçš„Shaderæœ‰æ‰€åŒºåˆ«ï¼Œåªæœ‰ä¸€ä¸ªuintæ•°æ®ï¼š\nstruct Attributes\r{\ruint vertexID : SV_VERTEXID;\r};\råœ¨é¡¶ç‚¹ç€è‰²å™¨è·å–åˆ°SV_VERTEXIDä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤æ¥è®¡ç®—å‡ºçº¿æ®µçš„åºå·lineIDå’Œæ¯ä¸ªé¡¶ç‚¹åœ¨ç»˜åˆ¶çº¿æ®µæ—¶çš„åºå·vertexIDã€‚åœ¨ç»˜åˆ¶æ—¶æˆ‘ä»¬åˆè¦çŸ¥é“å½“å‰çº¿æ®µçš„ä¸¤ä¸ªèŠ‚ç‚¹çš„ä½ç½®ï¼Œåœ¨ä¼ å…¥_VerticesBufferä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªé¡¶ç‚¹ç¡®å®šå…¶å¯¹åº”çš„çº¿æ®µèŠ‚ç‚¹çš„åºå·ï¼Œå³lineID + 0æˆ–è€…lineID + 1ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå¯ä»¥é€šè¿‡vertexIDç¡®å®šçš„0æˆ–è€…1å‚¨å­˜åˆ°ä¸€ä¸ªæ•°ç»„vertexIndexesä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨vertexIDè¯»å–ã€‚\nä¸ºäº†è®©çº¿æ®µå–å¾—è¾ƒå¥½çš„æŠ—é”¯é½¿æ•ˆæœï¼Œæˆ‘ä»¬æŠŠçº¿æ®µæ•´ä½“å¤–æ‰©äº†_OutlineWidthä¸ªåƒç´ å®½ï¼ˆå®é™…çº¿æ®µå®½åº¦æ˜¯è¿™ä¸ªçš„ä¸¤å€ï¼‰ã€‚æ­¤æ—¶å¯¹äºæ¯ä¸€ä¸ªé¡¶ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å¤–æ‰©ä¹‹åçš„å±å¹•ç©ºé—´çš„é¡¶ç‚¹ä½ç½®.ç”±äºæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä»LineStartåˆ°LineEndçš„æ–¹å‘offsetï¼ˆå¯¹äº1, 2, 4è¿™å‡ ä¸ªé¡¶ç‚¹æ¥è¯´ï¼Œoffsetæ˜¯ä»LineEndåˆ°LineStartçš„æ–¹å‘ï¼‰å’Œä¸å…¶ç›¸å‚ç›´çš„æ–¹å‘æ¥åšå¤–æ‰©ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ¯ä¸ªé¡¶ç‚¹çš„ä¸¤ä¸ªæ–¹å‘å€¼å‚¨å­˜åˆ°æ•°ç»„vertexOffsetsä¸­ã€‚å¯ä»¥çœ‹åˆ°é¡¶ç‚¹æ°¸è¿œæ˜¯å¾€è¿œç¦»è¾ƒè¿œèŠ‚ç‚¹çš„æ–¹å‘ç§»åŠ¨çš„ï¼Œå› æ­¤vertexOffsetçš„xå€¼éƒ½æ˜¯-1ã€‚è€Œæˆ‘ä»¬é€‰å–offseté€†æ—¶é’ˆæ—‹è½¬90Â°çš„æ–¹å‘ä½œä¸ºç›¸å‚ç›´çš„æ–¹å‘ï¼Œå› æ­¤vertexOffsetçš„yå€¼ä¼šæœ‰æ­£è´Ÿä¹‹åˆ†ã€‚\næœ€åæ˜¯uvçš„æ•°å€¼ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»™æ¯ä¸ªé¡¶ç‚¹ä¼ å…¥uvçš„æ•°å€¼ï¼Œå°±æ¯”è¾ƒç®€å•äº†ï¼Œå‚¨å­˜åˆ°æ•°ç»„vertexUVsä¸­ã€‚\næ­¤å¤–è¿˜è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“LineStartå’ŒLineEndå¯¹åº”çš„uvä½ç½®æ¥åšçº¿æ®µçš„åœ†å½¢ç«¯ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦æŠŠè¿™ä¸ªé•¿æ–¹ä½“çš„é«˜å®½æ¯”ratioä¼ ç»™ç‰‡å…ƒç€è‰²å™¨ã€‚\nè¿™æ ·ï¼Œæˆ‘ä»¬ç‰‡å…ƒç€è‰²å™¨çš„è¾“å…¥æ•°æ®å°±æ˜¯positionCSï¼Œuvå’Œratioäº†ï¼š\nstruct Varyings\r{\rfloat4 positionCS : SV_POSITION;\rfloat2 uv : TEXCOORD0;\rfloat ratio : TEXCOORD1;\r};\rç»˜åˆ¶çº¿æ¡çš„æµç¨‹  C#è„šæœ¬è·å–è¦ç»˜åˆ¶çº¿æ¡çš„èŠ‚ç‚¹æ•°æ®ï¼Œä¼ å…¥_VerticesBufferï¼Œè°ƒç”¨Graphics.DrawProceduralæ–¹æ³•è¿›è¡Œç»˜åˆ¶ã€‚ Shaderçš„é¡¶ç‚¹ç€è‰²å™¨æ ¹æ®SV_VERTEXIDè®¡ç®—å‡ºæ¯ä¸ªé¡¶ç‚¹å¯¹åº”çš„çº¿æ®µåºå·lineIDå’Œé¡¶ç‚¹åºå·vertexIDã€‚ é€šè¿‡çº¿æ®µåºå·ã€é¡¶ç‚¹åºå·å’ŒvertexIndexesä»_VerticesBufferä¸­æ‰¾åˆ°è¾ƒè¿‘çš„çº¿æ®µèŠ‚ç‚¹çš„ä¸–ç•Œåæ ‡ï¼Œå’Œè¾ƒè¿œçš„çº¿æ®µèŠ‚ç‚¹çš„ä¸–ç•Œåæ ‡ã€‚ å°†ä¸¤ä¸ªä¸–ç•Œåæ ‡è½¬æ¢åˆ°å±å¹•ç©ºé—´ï¼Œå¾—åˆ°å±å¹•ç©ºé—´ä¸¤ç‚¹å¯¹åº”çš„å‘é‡å’Œä¸ä¹‹ç›¸å‚ç›´çš„å‘é‡ï¼Œè¿›è¡Œå½’ä¸€åŒ–ã€‚ å°†æ¯ä¸ªé¡¶ç‚¹æ ¹æ®vertexOffsetså’Œæè¾¹å®½åº¦è¿›è¡Œå¤–æ‰©ã€‚ å°†å¤–æ‰©åçš„è£å‰ªç©ºé—´çš„åæ ‡ï¼Œä»vertexUVsä¸­è·å¾—çš„uvå’Œé«˜å®½æ¯”ratioä¼ ç»™ç‰‡å…ƒç€è‰²å™¨ã€‚ ç‰‡å…ƒç€è‰²å™¨æ ¹æ®ratioå’Œuvï¼Œç»˜åˆ¶å‡ºä¸€ä¸ªä¸¤å¤´åœ†å½¢çš„çº¿æ®µã€‚  DrawEqualWidthLine.cs C#è„šæœ¬æ¯”è¾ƒç®€å•äº†ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚\nusing UnityEngine; public class DrawEqualWidthLine : MonoBehaviour { public Vector3[] vertices; private int vertexCount; public Material equalWidthMaterial; ComputeBuffer verticesBuffer; private void EnsureBuffer(ref ComputeBuffer buffer, int count, int stride) { if (buffer == null) { buffer = new ComputeBuffer(count, stride, ComputeBufferType.Structured); } else if (buffer.count != count || buffer.stride != stride) { buffer.Release(); buffer = new ComputeBuffer(count, stride, ComputeBufferType.Structured); } } private void Awake() { vertexCount = vertices.Length; EnsureBuffer(ref verticesBuffer, vertexCount, 3 * 4); } private void Update() { if(vertexCount != vertices.Length) { vertexCount = vertices.Length; EnsureBuffer(ref verticesBuffer, vertexCount, 3 * 4); } Bounds bounds = new Bounds(Vector3.zero, Vector3.one * 100.0f); verticesBuffer.SetData(vertices); MaterialPropertyBlock mpb = new MaterialPropertyBlock(); mpb.SetBuffer(\"_VerticesBuffer\", verticesBuffer); Graphics.DrawProcedural(equalWidthMaterial, bounds, MeshTopology.Triangles, (vertexCount - 1) * 6, properties: mpb); } void OnDestroy() { verticesBuffer.Dispose(); } } EqualWidthLineShader.shader åŸºæœ¬ä¸Šéœ€è¦æ³¨æ„çš„éƒ½å†™åœ¨shaderçš„æ³¨é‡Šé‡Œé¢äº†ï¼Œä½¿ç”¨_OutlineColoræ¥æ§åˆ¶çº¿æ®µçš„é¢œè‰²ï¼Œ_OutlineWidthæ¥æ§åˆ¶çº¿æ®µçš„å®½åº¦ï¼Œ_Sharpnessæ¥æ§åˆ¶é”åˆ©ç¨‹åº¦ä»¥è¾¾åˆ°æŠ—é”¯é½¿çš„æ•ˆæœã€‚\nç‰¹åˆ«è¦æ³¨æ„çš„å°±æ˜¯å±å¹•æ¯”ä¾‹çš„é—®é¢˜ï¼Œè¦ç¡®ä¿åœ¨å±å¹•ä¸­ä¸¤ä¸ªåç§»æ–¹å‘æ˜¯äº’ç›¸å‚ç›´çš„ï¼Œè¿™æ ·æ‰èƒ½è·å¾—æ­£ç¡®çš„æ–°çš„è£å‰ªç©ºé—´çš„åæ ‡ï¼Œä¹Ÿæ‰èƒ½è·å¾—æ­£ç¡®çš„çº¿æ®µèŠ‚ç‚¹çš„uvå€¼ã€‚è¿˜æœ‰è¦æ³¨æ„ä»¿å°„å˜æ¢å’Œé€è§†å˜æ¢çš„åŒºåˆ«ï¼Œå‚è€ƒç»´åŸºç™¾ç§‘ä¸Šçš„è¯´æ˜ï¼Œå†³å®šäº†uvåœ¨å±å¹•ç©ºé—´ä¸­æ˜¯ä¸æ˜¯çº¿æ€§çš„ã€‚\nå½“ç„¶ä¸‰ä¸ªæ•°ç»„å¯ä»¥åˆå¹¶æˆä¸€ä¸ªï¼Œä¸è¿‡ä¹Ÿæ²¡é‚£ä¸ªå¿…è¦å°±æ˜¯äº†ã€‚\nShader \"zznewclear13/EqualWidthLineShader\"\r{\rProperties\r{\r_OutlineColor (\"Outline Color\", color) = (1.0, 1.0, 1.0, 1.0)\r_OutlineWidth(\"Outline Width\", float) = 10.0\r_Sharpness(\"Sharpness\", range(0, 0.99)) = 0.5\r}\rHLSLINCLUDE\r#include \"Packages/com.unity.render-pipelines.core/ShaderLibrary/Common.hlsl\"\r#include \"Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl\"\rStructuredBuffer _VerticesBuffer;\rfloat4 _OutlineColor;\rfloat _OutlineWidth;\rfloat _Sharpness;\rstatic int vertexIndexes[] = {\r0, 1, 1, 0, 1, 0\r};\rstatic float2 vertexOffsets[] = {\rfloat2(-1, -1),\rfloat2(-1, 1),\rfloat2(-1, -1),\rfloat2(-1, -1),\rfloat2(-1, -1),\rfloat2(-1, 1),\r};\rstatic float2 vertexUVs[] = {\rfloat2(0, 0),\rfloat2(1, 0),\rfloat2(1, 1),\rfloat2(0, 0),\rfloat2(1, 1),\rfloat2(0, 1),\r};\rstruct Attributes\r{\ruint vertexID : SV_VERTEXID;\r};\rstruct Varyings\r{\rfloat4 positionCS : SV_POSITION;\rfloat2 uv : TEXCOORD0;\rfloat ratio : TEXCOORD1;\r};\rVaryings Vert(Attributes input)\r{\rVaryings output = (Varyings)0;\rint vertexID = input.vertexID % 6;\rint lineID = input.vertexID / 6;\r//è·å–è¾ƒè¿‘çš„çº¿æ®µèŠ‚ç‚¹çš„ä¸–ç•Œåæ ‡ï¼Œå’Œè¾ƒè¿œçš„çº¿æ®µèŠ‚ç‚¹çš„ä¸–ç•Œåæ ‡\rfloat3 vertexPos = _VerticesBuffer[lineID + vertexIndexes[vertexID]];\rfloat3 anotherVert = _VerticesBuffer[lineID + 1 - vertexIndexes[vertexID]];\r//è½¬æ¢åˆ°è£å‰ªç©ºé—´\rfloat4 positionCS = mul(UNITY_MATRIX_VP, float4(vertexPos, 1.0));\rfloat4 anotherCS = mul(UNITY_MATRIX_VP, float4(anotherVert, 1.0));\r//Unityç›¸æœºæ˜¯çœ‹å‘Zè½´è´Ÿæ–¹å‘çš„ï¼Œæ‰€ä»¥è£å‰ªç©ºé—´wåˆ†é‡å°äº0\r//è¿™é‡Œå°±ä¸éœ€è¦ç”¨ä»è¿œçš„èŠ‚ç‚¹å‡å»è¿‘çš„èŠ‚ç‚¹äº†\rfloat2 offset = positionCS.xy / positionCS.w - anotherCS.xy / anotherCS.w;\r//å¾—åˆ°é•¿æ–¹å½¢å®½åº¦\rfloat lengthOffset = length(offset);\r//è¦è€ƒè™‘åˆ°å±å¹•çš„æ¯”ä¾‹\rfloat2 normalizedOffset = normalize(offset * (_ScreenParams.wz - 1.0));\rfloat2 pointOffset = vertexOffsets[vertexID];\rfloat2 pointOffsetX = float2(normalizedOffset.x, normalizedOffset.y) * pointOffset.x;\rfloat2 pointOffsetY = float2(-normalizedOffset.y, normalizedOffset.x) * pointOffset.y;\r//è€ƒè™‘åˆ°å±å¹•çš„æ¯”ä¾‹ï¼Œæ ¹æ®ä¸Šé¢çš„ä¸¤ä¸ªOffsetï¼Œå¾—åˆ°æ–°çš„è£å‰ªç©ºé—´çš„åæ ‡\rfloat4 newClipPos = float4(-positionCS.w * (pointOffsetX + pointOffsetY) * (_ScreenParams.zw - 1.0) * _OutlineWidth, 0, 0) + positionCS;\r//ç®—çš„ä¸ä¸€å®šå¯¹ï¼Œä¸è¿‡ä¹Ÿå¤§å·®ä¸å·®äº†ã€‚ã€‚\rfloat lengthRadius = _OutlineWidth * length(pointOffsetX * (_ScreenParams.zw - 1.0));\routput.positionCS = newClipPos;\r//å¦‚æœä¸ä¹˜ä¸Šæ·±åº¦çš„è¯ï¼Œä¼šæœ‰é€è§†å˜å½¢çš„é—®é¢˜\r//https://en.wikipedia.org/wiki/Texture_mapping#Affine_texture_mapping\routput.uv = vertexUVs[vertexID] * (-newClipPos.w);\routput.ratio = 2.0 * lengthRadius / (2.0 * lengthRadius + lengthOffset);\rreturn output;\r}\rfloat GetDist(float2 uv, float ratio)\r{\ruv.x = 0.5 - abs(0.5 - uv.x);\rfloat2 coord = float2(uv.x * rcp(ratio), uv.y);\rfloat2 center = float2(0.5, 0.5);\rfloat distToCenter = length(coord - center);\rfloat distToLine = abs(uv.y - 0.5);\rreturn coord.x ç»“è¯­ æˆ‘å¯¹ç›®å‰çš„æ•ˆæœè¿˜æ˜¯å¾ˆæ»¡æ„çš„ï¼ä¹Ÿæ²¡çœ‹åˆ°æœ‰ä»€ä¹ˆäººåšè¿™ä¸ªç”»çº¿çš„æ“ä½œï¼ˆé™¤äº†Shapesï¼Œå½“ç„¶æˆ‘ä¹Ÿæ²¡å»æœç´¢åˆ«çš„æ¡ˆä¾‹å°±æ˜¯äº†ï¼‰ã€‚æ„Ÿè§‰å¯¹ç»˜åˆ¶é¡¶ç‚¹æ—¶çš„å¤„ç†å’Œç©ºé—´å˜æ¢çš„ç†è§£åˆå¤§å¤§åŠ æ·±äº†ï¼ä¸‹ä¸€ä¸ªç›®æ ‡å°±æ˜¯æè¾¹çš„è®¡ç®—äº†ï¼Œç›®å‰æ„Ÿè§‰ä¸Šä¼šå’ŒåŸå§‹æ¨¡å‹æœ‰æ·±åº¦æµ‹è¯•çš„é—®é¢˜ï¼Œåªèƒ½èµ°ä¸€æ­¥çœ‹ä¸€æ­¥äº†ã€‚\nè¿™æ®µæ—¶é—´ä¸€ç›´åœ¨æ€è€ƒæ™¯æ·±å’Œå†™ShaderToyï¼Œä¹Ÿç®—æ”¶è·ä¸å°‘ï¼Œä¸è¿‡æ²¡èƒ½å†™å‡ºåšå®¢æ¥ï¼Œæ‹¿è¿™ä¸ªç­‰å®½ä¸”æŠ—é”¯é½¿çš„ä¸–ç•Œåæ ‡ç›´çº¿æ¥å¼¥è¡¥ä¸€ä¸‹ã€‚\n","wordCount":"547","inLanguage":"en","image":"https://zznewclear13.github.io/posts/draw-equal-width-line-in-unity/posts/images/EqualWidthLine.jpg","datePublished":"2021-12-02T17:00:00+08:00","dateModified":"2021-12-02T17:00:00+08:00","author":{"@type":"Person","name":"zznewclear13"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zznewclear13.github.io/posts/draw-equal-width-line-in-unity/"},"publisher":{"@type":"Organization","name":"ZZNEWCLEAR13","logo":{"@type":"ImageObject","url":"https://zznewclear13.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://zznewclear13.github.io/ accesskey=h title="ZZNEWCLEAR13 (Alt + H)"><img src=https://zznewclear13.github.io/apple-touch-icon.png alt aria-label=logo height=35>ZZNEWCLEAR13</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zznewclear13.github.io/now/ title=è¿›è¡Œæ—¶><span>è¿›è¡Œæ—¶</span></a></li><li><a href=https://zznewclear13.github.io/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://zznewclear13.github.io/categories/ title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=https://zznewclear13.github.io/links/ title=å‹æƒ…é“¾æ¥><span>å‹æƒ…é“¾æ¥</span></a></li><li><a href=https://zznewclear13.github.io/search/ title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zznewclear13.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://zznewclear13.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">åœ¨Unityä¸­ç»˜åˆ¶ç­‰å®½çº¿æ¡</h1><div class=post-description>åœ¨Unityä¸–ç•Œç©ºé—´ä¸­ç”»ä¸€æ¡ç­‰å®½ä¸”æŠ—é”¯é½¿çš„ç›´çº¿.</div><div class=post-meta><span title="2021-12-02 17:00:00 +0800 CST">December 2, 2021</span>&nbsp;Â·&nbsp;zznewclear13&nbsp;|&nbsp;<a href=https://github.com/zznewclear13/zznewclear13.com/blob/main/content/posts/draw-equal-width-line-in-unity.md rel="noopener noreferrer" target=_blank>ç¼–è¾‘</a></div></header><figure class=entry-cover><img loading=eager src=https://zznewclear13.github.io/posts/images/EqualWidthLine.jpg alt="Equal Width Line Cover"><p>Equal Width Lines</p></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><div class=details>åœ¨Unityä¸­ç»˜åˆ¶ç­‰å®½çº¿æ¡</div></summary><div class=inner><ul><li><a href=#%e5%8a%a8%e6%9c%ba aria-label=åŠ¨æœº>åŠ¨æœº</a></li><li><a href=#%e6%8a%97%e9%94%af%e9%bd%bf%e5%92%8c%e5%ae%bd%e5%ba%a6%e7%9a%84%e6%80%9d%e8%80%83 aria-label=æŠ—é”¯é½¿å’Œå®½åº¦çš„æ€è€ƒ>æŠ—é”¯é½¿å’Œå®½åº¦çš„æ€è€ƒ</a></li><li><a href=#%e5%85%b7%e4%bd%93%e7%9a%84%e7%bb%98%e5%88%b6%e7%ba%bf%e6%9d%a1%e7%9a%84%e6%93%8d%e4%bd%9c aria-label=å…·ä½“çš„ç»˜åˆ¶çº¿æ¡çš„æ“ä½œ>å…·ä½“çš„ç»˜åˆ¶çº¿æ¡çš„æ“ä½œ</a></li><li><a href=#%e7%bb%98%e5%88%b6%e7%ba%bf%e6%9d%a1%e7%9a%84%e6%b5%81%e7%a8%8b aria-label=ç»˜åˆ¶çº¿æ¡çš„æµç¨‹>ç»˜åˆ¶çº¿æ¡çš„æµç¨‹</a><ul><li><a href=#drawequalwidthlinecs aria-label=DrawEqualWidthLine.cs>DrawEqualWidthLine.cs</a></li><li><a href=#equalwidthlineshadershader aria-label=EqualWidthLineShader.shader>EqualWidthLineShader.shader</a></li></ul></li><li><a href=#%e7%bb%93%e8%af%ad aria-label=ç»“è¯­>ç»“è¯­</a></li></ul></div></details></div><div class=post-content><h2 id=åŠ¨æœº>åŠ¨æœº<a hidden class=anchor aria-hidden=true href=#åŠ¨æœº>#</a></h2><p>ç›´æ¥åŠ¨æœºæ˜¯æƒ³è¦åœ¨unityä¸­åˆ¶ä½œä¸€ä¸ªæè¾¹æ•ˆæœã€‚å¯¹äºå¡é€šæ¸²æŸ“çš„æè¾¹æ•ˆæœï¼Œå·²ç»æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ¡ˆä¾‹äº†ï¼Œä½†æ˜¯æˆ‘è§‰å¾—è¿™äº›æ¡ˆä¾‹ä¸ä¸€å®šèƒ½å®Œå…¨æ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼Œäºæ˜¯æƒ³è¦ä»ç”»ç›´çº¿å¼€å§‹ç ”ç©¶ã€‚</p><p>ä»æ™®é€šç»˜ç”»çš„è§’åº¦æ¥çœ‹ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯æè¾¹çš„å®½åº¦åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼šè€ƒè™‘ä¸€ä¸‹è¿œæ™¯çš„ç‰©ä½“ï¼Œç”»å®¶åœ¨ç»˜ç”»çš„æ—¶å€™ä½¿ç”¨å’Œè¿‘æ™¯ç›¸åŒç²—ç»†çš„ç¬”ï¼ˆç”¨ä¸€æ ·æˆ–è€…ç¨å¼±çš„åŠ›ï¼‰ï¼Œç»˜åˆ¶ä¸€ä¸ªè¾ƒä¸ç²¾ç»†çš„ç‰©ä½“ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¾ˆç»†çš„ç¬”å»ç»˜åˆ¶ä¸€ä¸ªç²¾ç»†çš„ç‰©ä½“ï¼Œç»“è®ºå°±æ˜¯è¿œå¤„çš„æè¾¹å¯èƒ½ç¨ç»†ä¸€äº›ï¼Œä½†æœ€å¥½æ˜¯ç›¸åŒç²—ç»†ï¼Œå…¶é¢œè‰²å¯èƒ½ä¼šå˜æµ…ã€‚</p><p>ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œæè¾¹å¾€å¾€éœ€è¦èƒ½å¤Ÿæ§åˆ¶å…¶å®½åº¦ï¼Œå¯¹äºè¾ƒç»†çš„çº¿ï¼Œåˆ™ä¼šæœ‰è¾ƒæ˜æ˜¾çš„é”¯é½¿ï¼ˆäº‹å®ä¸Šåªè¦è§’åº¦ä¸å¤ªå¥½çš„æè¾¹ï¼Œå°±ä¼šæœ‰å¾ˆæ˜æ˜¾çš„è¾¹ç¼˜é”¯é½¿ï¼‰ï¼Œé‚£ä¹ˆæ§åˆ¶ç²—ç»†å’Œè¿›è¡Œä¸€å®šç¨‹åº¦çš„æŠ—é”¯é½¿ä¹Ÿæ˜¯ä¸€ä¸ªç ”ç©¶çš„æ–¹å‘ã€‚</p><p>ä»ç¬¬ä¸‰ä¸ªè§’åº¦ï¼Œç¢°å·§çœ‹åˆ°äº†Freya HolmÃ©råˆ¶ä½œçš„<a href=https://assetstore.unity.com/packages/tools/particles-effects/shapes-173167>Shapes</a>æ’ä»¶ï¼Œèƒ½å¤Ÿç»˜åˆ¶é«˜è´¨é‡çš„çº¿æ¡ç”»ï¼Œçœ‹ä¸Šå»æ¸²æŸ“çš„æ•ˆæœå¾ˆå¥½ã€‚ä½†æ˜¯ä»·æ ¼è¿‡äºé«˜æ˜‚ï¼Œäºæ˜¯æƒ³è¦ç ”ç©¶ä¸€ä¸ªèƒ½å¤Ÿåšåˆ°å·®ä¸å¤šæ•ˆæœçš„å·¥å…·ã€‚</p><h2 id=æŠ—é”¯é½¿å’Œå®½åº¦çš„æ€è€ƒ>æŠ—é”¯é½¿å’Œå®½åº¦çš„æ€è€ƒ<a hidden class=anchor aria-hidden=true href=#æŠ—é”¯é½¿å’Œå®½åº¦çš„æ€è€ƒ>#</a></h2><p>åœ¨Unityä¸­ç”»ç›´çº¿æœ‰è›®å¤šåŠæ³•ï¼Œ<code>Debug.DrawLine</code>æˆ–è€…<code>Gizmos.DrawLine</code>éƒ½èƒ½ç»˜åˆ¶ç­‰å®½çš„ç›´çº¿ï¼Œä¸è¿‡åªèƒ½å›ºå®šä¸€ä¸ªåƒç´ å®½ï¼Œè€Œä¸”å› ä¸ºåªæœ‰ä¸€ä¸ªåƒç´ å®½ï¼Œæ‰€ä»¥ä¼šæœ‰æ˜æ˜¾çš„é”¯é½¿ã€‚ä½¿ç”¨<code>LineRenderer</code>å¯ä»¥ç»˜åˆ¶ä»»æ„å®½åº¦çš„ç›´çº¿ï¼Œå†™ç‰¹å®šçš„shaderé€šè¿‡é€æ˜åº¦æ··åˆèƒ½å¤Ÿé˜²æ­¢é”¯é½¿çš„å‡ºç°ï¼ˆä¸è¿‡çº¿æ®µä¸¤ç«¯ä¸å¤ªå¥½åšæŠ—é”¯é½¿ï¼‰ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åœ¨ä¸åŒè§’åº¦ä¸‹ç›´çº¿çš„å®½åº¦ç›¸ç­‰ã€‚é‚£ä¹ˆç­”æ¡ˆå°±å¾ˆæ˜æ˜¾äº†ï¼Œé€šè¿‡çº¿æ®µçš„é¡¶ç‚¹çš„æ•°æ®ï¼Œç”Ÿæˆä¸¤ä¸ªä¸‰è§’é¢ï¼ˆä¸€ä¸ªQuadï¼‰ï¼Œåœ¨GPUä¸­è®¡ç®—å‡ºä¸‰è§’é¢æ¯ä¸ªé¡¶ç‚¹çš„å±å¹•ç©ºé—´çš„ä½ç½®ï¼Œç¡®ä¿çº¿æ®µçš„å®½åº¦ä¸€è‡´ã€‚ä¹Ÿç”±äºæœ‰å®½åº¦çš„å­˜åœ¨ï¼Œç»™åç»­çš„é€æ˜åº¦æ··åˆæŠ—é”¯é½¿ç•™ä¸‹äº†æ“ä½œçš„ç©ºé—´ã€‚</p><h2 id=å…·ä½“çš„ç»˜åˆ¶çº¿æ¡çš„æ“ä½œ>å…·ä½“çš„ç»˜åˆ¶çº¿æ¡çš„æ“ä½œ<a hidden class=anchor aria-hidden=true href=#å…·ä½“çš„ç»˜åˆ¶çº¿æ¡çš„æ“ä½œ>#</a></h2><p>é¦–å…ˆçœ‹ä¸€å¼ å›¾ï¼ˆå®Œäº†ä¸‰è§’å½¢é¡¶ç‚¹é¡ºåºç”»åäº†ï¼Œå·²ç»ç§¯é‡éš¾è¿”äº†ï¼Œä»£ç è¡¨ç°å¯¹å°±å½“åšå¯¹çš„å§ï¼‰
<img loading=lazy src=../images/EqualWidthLineDiagram.jpg alt="Equal Width Line Diagram"></p><p>æˆ‘ä»¬å°†ä½¿ç”¨<code>Graphics.DrawProcedural</code>è¿™ä¸ªæ–¹æ³•æ¥ç»˜åˆ¶æˆ‘ä»¬çš„ç›´çº¿ï¼Œæ¯ä¸€æ®µç›´çº¿ç”±ä¸¤ä¸ªä¸‰è§’å½¢ç»„æˆï¼ˆè¿™é‡Œè¦æ³¨æ„åœ¨unityä¸­ä¸‰è§’å½¢é¡¶ç‚¹é¡ºåºæ˜¯é¡ºæ—¶é’ˆçš„ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ç»˜åˆ¶Næ¡ç›´çº¿çš„è¯ï¼Œè¦ä¼ å…¥N+1ä¸ªèŠ‚ç‚¹ä½ç½®æ•°æ®ï¼Œè€Œå®é™…ç»˜åˆ¶æ—¶ä¼šç»˜åˆ¶6Nä¸ªé¡¶ç‚¹ã€‚è¿™æ ·ä¼ å…¥Shaderçš„æ˜¯ä¸€ä¸ªè¡¨ç¤ºçº¿æ®µèŠ‚ç‚¹ä½ç½®çš„é•¿åº¦æ˜¯N+1çš„Vector3æ•°æ®<code>_VerticesBuffer</code>ï¼Œå’Œä¸€ä¸ªè¡¨ç¤ºé¡¶ç‚¹åºå·çš„ä»0åˆ°6N-1çš„uintæ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨ç»˜åˆ¶æ—¶å›¾å½¢APIè‡ªåŠ¨ä¼ è¾“çš„<code>SV_VERTEXID</code>ã€‚</p><p>è¿™ä¹Ÿå°±å¯¼è‡´äº†æˆ‘ä»¬çš„é¡¶ç‚¹ç€è‰²å™¨è¾“å…¥æ•°æ®å’Œæ™®é€šçš„Shaderæœ‰æ‰€åŒºåˆ«ï¼Œåªæœ‰ä¸€ä¸ªuintæ•°æ®ï¼š</p><pre><code class=language-HLSL data-lang=HLSL>struct Attributes
{
    uint vertexID    : SV_VERTEXID;
};
</code></pre><p>åœ¨é¡¶ç‚¹ç€è‰²å™¨è·å–åˆ°<code>SV_VERTEXID</code>ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤æ¥è®¡ç®—å‡ºçº¿æ®µçš„åºå·<code>lineID</code>å’Œæ¯ä¸ªé¡¶ç‚¹åœ¨ç»˜åˆ¶çº¿æ®µæ—¶çš„åºå·<code>vertexID</code>ã€‚åœ¨ç»˜åˆ¶æ—¶æˆ‘ä»¬åˆè¦çŸ¥é“å½“å‰çº¿æ®µçš„ä¸¤ä¸ªèŠ‚ç‚¹çš„ä½ç½®ï¼Œåœ¨ä¼ å…¥<code>_VerticesBuffer</code>ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªé¡¶ç‚¹ç¡®å®šå…¶å¯¹åº”çš„çº¿æ®µèŠ‚ç‚¹çš„åºå·ï¼Œå³<code>lineID + 0</code>æˆ–è€…<code>lineID + 1</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå¯ä»¥é€šè¿‡<code>vertexID</code>ç¡®å®šçš„0æˆ–è€…1å‚¨å­˜åˆ°ä¸€ä¸ªæ•°ç»„<code>vertexIndexes</code>ä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨<code>vertexID</code>è¯»å–ã€‚</p><p>ä¸ºäº†è®©çº¿æ®µå–å¾—è¾ƒå¥½çš„æŠ—é”¯é½¿æ•ˆæœï¼Œæˆ‘ä»¬æŠŠçº¿æ®µæ•´ä½“å¤–æ‰©äº†<code>_OutlineWidth</code>ä¸ªåƒç´ å®½ï¼ˆå®é™…çº¿æ®µå®½åº¦æ˜¯è¿™ä¸ªçš„ä¸¤å€ï¼‰ã€‚æ­¤æ—¶å¯¹äºæ¯ä¸€ä¸ªé¡¶ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å¤–æ‰©ä¹‹åçš„å±å¹•ç©ºé—´çš„é¡¶ç‚¹ä½ç½®.ç”±äºæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä»<code>LineStart</code>åˆ°<code>LineEnd</code>çš„æ–¹å‘<code>offset</code>ï¼ˆå¯¹äº1, 2, 4è¿™å‡ ä¸ªé¡¶ç‚¹æ¥è¯´ï¼Œ<code>offset</code>æ˜¯ä»<code>LineEnd</code>åˆ°<code>LineStart</code>çš„æ–¹å‘ï¼‰å’Œä¸å…¶ç›¸å‚ç›´çš„æ–¹å‘æ¥åšå¤–æ‰©ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ¯ä¸ªé¡¶ç‚¹çš„ä¸¤ä¸ªæ–¹å‘å€¼å‚¨å­˜åˆ°æ•°ç»„<code>vertexOffsets</code>ä¸­ã€‚å¯ä»¥çœ‹åˆ°é¡¶ç‚¹æ°¸è¿œæ˜¯å¾€è¿œç¦»è¾ƒè¿œèŠ‚ç‚¹çš„æ–¹å‘ç§»åŠ¨çš„ï¼Œå› æ­¤<code>vertexOffset</code>çš„xå€¼éƒ½æ˜¯-1ã€‚è€Œæˆ‘ä»¬é€‰å–<code>offset</code>é€†æ—¶é’ˆæ—‹è½¬90Â°çš„æ–¹å‘ä½œä¸ºç›¸å‚ç›´çš„æ–¹å‘ï¼Œå› æ­¤<code>vertexOffset</code>çš„yå€¼ä¼šæœ‰æ­£è´Ÿä¹‹åˆ†ã€‚</p><p>æœ€åæ˜¯uvçš„æ•°å€¼ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»™æ¯ä¸ªé¡¶ç‚¹ä¼ å…¥uvçš„æ•°å€¼ï¼Œå°±æ¯”è¾ƒç®€å•äº†ï¼Œå‚¨å­˜åˆ°æ•°ç»„<code>vertexUVs</code>ä¸­ã€‚</p><p>æ­¤å¤–è¿˜è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“<code>LineStart</code>å’Œ<code>LineEnd</code>å¯¹åº”çš„uvä½ç½®æ¥åšçº¿æ®µçš„åœ†å½¢ç«¯ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦æŠŠè¿™ä¸ªé•¿æ–¹ä½“çš„é«˜å®½æ¯”<code>ratio</code>ä¼ ç»™ç‰‡å…ƒç€è‰²å™¨ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬ç‰‡å…ƒç€è‰²å™¨çš„è¾“å…¥æ•°æ®å°±æ˜¯<code>positionCS</code>ï¼Œ<code>uv</code>å’Œ<code>ratio</code>äº†ï¼š</p><pre><code class=language-HLSL data-lang=HLSL>struct Varyings
{
    float4 positionCS   : SV_POSITION;
    float2 uv           : TEXCOORD0;
    float ratio         : TEXCOORD1;
};
</code></pre><h2 id=ç»˜åˆ¶çº¿æ¡çš„æµç¨‹>ç»˜åˆ¶çº¿æ¡çš„æµç¨‹<a hidden class=anchor aria-hidden=true href=#ç»˜åˆ¶çº¿æ¡çš„æµç¨‹>#</a></h2><ol><li>C#è„šæœ¬è·å–è¦ç»˜åˆ¶çº¿æ¡çš„èŠ‚ç‚¹æ•°æ®ï¼Œä¼ å…¥<code>_VerticesBuffer</code>ï¼Œè°ƒç”¨<code>Graphics.DrawProcedural</code>æ–¹æ³•è¿›è¡Œç»˜åˆ¶ã€‚</li><li>Shaderçš„é¡¶ç‚¹ç€è‰²å™¨æ ¹æ®<code>SV_VERTEXID</code>è®¡ç®—å‡ºæ¯ä¸ªé¡¶ç‚¹å¯¹åº”çš„çº¿æ®µåºå·<code>lineID</code>å’Œé¡¶ç‚¹åºå·<code>vertexID</code>ã€‚</li><li>é€šè¿‡çº¿æ®µåºå·ã€é¡¶ç‚¹åºå·å’Œ<code>vertexIndexes</code>ä»<code>_VerticesBuffer</code>ä¸­æ‰¾åˆ°è¾ƒè¿‘çš„çº¿æ®µèŠ‚ç‚¹çš„ä¸–ç•Œåæ ‡ï¼Œå’Œè¾ƒè¿œçš„çº¿æ®µèŠ‚ç‚¹çš„ä¸–ç•Œåæ ‡ã€‚</li><li>å°†ä¸¤ä¸ªä¸–ç•Œåæ ‡è½¬æ¢åˆ°å±å¹•ç©ºé—´ï¼Œå¾—åˆ°å±å¹•ç©ºé—´ä¸¤ç‚¹å¯¹åº”çš„å‘é‡å’Œä¸ä¹‹ç›¸å‚ç›´çš„å‘é‡ï¼Œè¿›è¡Œå½’ä¸€åŒ–ã€‚</li><li>å°†æ¯ä¸ªé¡¶ç‚¹æ ¹æ®<code>vertexOffsets</code>å’Œæè¾¹å®½åº¦è¿›è¡Œå¤–æ‰©ã€‚</li><li>å°†å¤–æ‰©åçš„è£å‰ªç©ºé—´çš„åæ ‡ï¼Œä»<code>vertexUVs</code>ä¸­è·å¾—çš„uvå’Œé«˜å®½æ¯”<code>ratio</code>ä¼ ç»™ç‰‡å…ƒç€è‰²å™¨ã€‚</li><li>ç‰‡å…ƒç€è‰²å™¨æ ¹æ®<code>ratio</code>å’Œ<code>uv</code>ï¼Œç»˜åˆ¶å‡ºä¸€ä¸ªä¸¤å¤´åœ†å½¢çš„çº¿æ®µã€‚</li></ol><h3 id=drawequalwidthlinecs>DrawEqualWidthLine.cs<a hidden class=anchor aria-hidden=true href=#drawequalwidthlinecs>#</a></h3><p>C#è„šæœ¬æ¯”è¾ƒç®€å•äº†ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=color:#66d9ef>using</span> UnityEngine;

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DrawEqualWidthLine</span> : MonoBehaviour
{
    <span style=color:#66d9ef>public</span> Vector3[] vertices;
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> vertexCount;

    <span style=color:#66d9ef>public</span> Material equalWidthMaterial;
    ComputeBuffer verticesBuffer;

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> EnsureBuffer(<span style=color:#66d9ef>ref</span> ComputeBuffer buffer, <span style=color:#66d9ef>int</span> count, <span style=color:#66d9ef>int</span> stride)
    {
        <span style=color:#66d9ef>if</span> (buffer == <span style=color:#66d9ef>null</span>)
        {
            buffer = <span style=color:#66d9ef>new</span> ComputeBuffer(count, stride, ComputeBufferType.Structured);
        }
        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (buffer.count != count || buffer.stride != stride)
        {
            buffer.Release();
            buffer = <span style=color:#66d9ef>new</span> ComputeBuffer(count, stride, ComputeBufferType.Structured);
        }
    }

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> Awake()
    {
        vertexCount = vertices.Length;
        EnsureBuffer(<span style=color:#66d9ef>ref</span> verticesBuffer, vertexCount, <span style=color:#ae81ff>3</span> * <span style=color:#ae81ff>4</span>);
    }

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> Update()
    {
        <span style=color:#66d9ef>if</span>(vertexCount != vertices.Length)
        {
            vertexCount = vertices.Length;
            EnsureBuffer(<span style=color:#66d9ef>ref</span> verticesBuffer, vertexCount, <span style=color:#ae81ff>3</span> * <span style=color:#ae81ff>4</span>);
        }

        Bounds bounds = <span style=color:#66d9ef>new</span> Bounds(Vector3.zero, Vector3.one * <span style=color:#ae81ff>100.0f</span>);
        verticesBuffer.SetData(vertices);

        MaterialPropertyBlock mpb = <span style=color:#66d9ef>new</span> MaterialPropertyBlock();
        mpb.SetBuffer(<span style=color:#e6db74>&#34;_VerticesBuffer&#34;</span>, verticesBuffer);

        Graphics.DrawProcedural(equalWidthMaterial, bounds, MeshTopology.Triangles, (vertexCount - <span style=color:#ae81ff>1</span>) * <span style=color:#ae81ff>6</span>, properties: mpb);
    }

    <span style=color:#66d9ef>void</span> OnDestroy()
    {
        verticesBuffer.Dispose();
    }
}
</code></pre></div><h3 id=equalwidthlineshadershader>EqualWidthLineShader.shader<a hidden class=anchor aria-hidden=true href=#equalwidthlineshadershader>#</a></h3><p>åŸºæœ¬ä¸Šéœ€è¦æ³¨æ„çš„éƒ½å†™åœ¨shaderçš„æ³¨é‡Šé‡Œé¢äº†ï¼Œä½¿ç”¨<code>_OutlineColor</code>æ¥æ§åˆ¶çº¿æ®µçš„é¢œè‰²ï¼Œ<code>_OutlineWidth</code>æ¥æ§åˆ¶çº¿æ®µçš„å®½åº¦ï¼Œ<code>_Sharpness</code>æ¥æ§åˆ¶é”åˆ©ç¨‹åº¦ä»¥è¾¾åˆ°æŠ—é”¯é½¿çš„æ•ˆæœã€‚</p><p>ç‰¹åˆ«è¦æ³¨æ„çš„å°±æ˜¯å±å¹•æ¯”ä¾‹çš„é—®é¢˜ï¼Œè¦ç¡®ä¿åœ¨å±å¹•ä¸­ä¸¤ä¸ªåç§»æ–¹å‘æ˜¯äº’ç›¸å‚ç›´çš„ï¼Œè¿™æ ·æ‰èƒ½è·å¾—æ­£ç¡®çš„æ–°çš„è£å‰ªç©ºé—´çš„åæ ‡ï¼Œä¹Ÿæ‰èƒ½è·å¾—æ­£ç¡®çš„çº¿æ®µèŠ‚ç‚¹çš„uvå€¼ã€‚è¿˜æœ‰è¦æ³¨æ„ä»¿å°„å˜æ¢å’Œé€è§†å˜æ¢çš„åŒºåˆ«ï¼Œå‚è€ƒç»´åŸºç™¾ç§‘ä¸Šçš„<a href=https://en.wikipedia.org/wiki/Texture_mapping#Affine_texture_mapping>è¯´æ˜</a>ï¼Œå†³å®šäº†uvåœ¨å±å¹•ç©ºé—´ä¸­æ˜¯ä¸æ˜¯çº¿æ€§çš„ã€‚</p><p>å½“ç„¶ä¸‰ä¸ªæ•°ç»„å¯ä»¥åˆå¹¶æˆä¸€ä¸ªï¼Œä¸è¿‡ä¹Ÿæ²¡é‚£ä¸ªå¿…è¦å°±æ˜¯äº†ã€‚</p><pre><code class=language-HLSL data-lang=HLSL>Shader &quot;zznewclear13/EqualWidthLineShader&quot;
{
    Properties
    {
        _OutlineColor (&quot;Outline Color&quot;, color) = (1.0, 1.0, 1.0, 1.0)
        _OutlineWidth(&quot;Outline Width&quot;, float) = 10.0
        _Sharpness(&quot;Sharpness&quot;, range(0, 0.99)) = 0.5
    }
    HLSLINCLUDE
    #include &quot;Packages/com.unity.render-pipelines.core/ShaderLibrary/Common.hlsl&quot;
    #include &quot;Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl&quot;

    StructuredBuffer&lt;float3&gt; _VerticesBuffer;
    float4 _OutlineColor;
    float _OutlineWidth;
    float _Sharpness;

    static int vertexIndexes[] = 
    {
        0, 1, 1, 0, 1, 0
    };

    static float2 vertexOffsets[] = 
    {
        float2(-1, -1),
        float2(-1, 1),
        float2(-1, -1),
        float2(-1, -1),
        float2(-1, -1),
        float2(-1, 1),
    };

    static float2 vertexUVs[] = 
    {
        float2(0, 0),
        float2(1, 0),
        float2(1, 1),
        float2(0, 0),
        float2(1, 1),
        float2(0, 1),
    };

    struct Attributes
    {
        uint vertexID    : SV_VERTEXID;
    };

    struct Varyings
    {
        float4 positionCS   : SV_POSITION;
        float2 uv           : TEXCOORD0;
        float ratio         : TEXCOORD1;
    };

    Varyings Vert(Attributes input)
    {
        Varyings output = (Varyings)0;
        int vertexID = input.vertexID % 6;
        int lineID = input.vertexID / 6;

        //è·å–è¾ƒè¿‘çš„çº¿æ®µèŠ‚ç‚¹çš„ä¸–ç•Œåæ ‡ï¼Œå’Œè¾ƒè¿œçš„çº¿æ®µèŠ‚ç‚¹çš„ä¸–ç•Œåæ ‡
        float3 vertexPos = _VerticesBuffer[lineID + vertexIndexes[vertexID]];
        float3 anotherVert = _VerticesBuffer[lineID + 1 - vertexIndexes[vertexID]];
        //è½¬æ¢åˆ°è£å‰ªç©ºé—´
        float4 positionCS = mul(UNITY_MATRIX_VP, float4(vertexPos, 1.0));
        float4 anotherCS = mul(UNITY_MATRIX_VP, float4(anotherVert, 1.0));

        //Unityç›¸æœºæ˜¯çœ‹å‘Zè½´è´Ÿæ–¹å‘çš„ï¼Œæ‰€ä»¥è£å‰ªç©ºé—´wåˆ†é‡å°äº0
        //è¿™é‡Œå°±ä¸éœ€è¦ç”¨ä»è¿œçš„èŠ‚ç‚¹å‡å»è¿‘çš„èŠ‚ç‚¹äº†
        float2 offset = positionCS.xy / positionCS.w - anotherCS.xy / anotherCS.w;
        //å¾—åˆ°é•¿æ–¹å½¢å®½åº¦
        float lengthOffset = length(offset);
        //è¦è€ƒè™‘åˆ°å±å¹•çš„æ¯”ä¾‹
        float2 normalizedOffset = normalize(offset * (_ScreenParams.wz - 1.0));
        float2 pointOffset = vertexOffsets[vertexID];
        float2 pointOffsetX = float2(normalizedOffset.x, normalizedOffset.y) * pointOffset.x;
        float2 pointOffsetY = float2(-normalizedOffset.y, normalizedOffset.x) * pointOffset.y;

        //è€ƒè™‘åˆ°å±å¹•çš„æ¯”ä¾‹ï¼Œæ ¹æ®ä¸Šé¢çš„ä¸¤ä¸ªOffsetï¼Œå¾—åˆ°æ–°çš„è£å‰ªç©ºé—´çš„åæ ‡
        float4 newClipPos = float4(-positionCS.w * (pointOffsetX + pointOffsetY) * (_ScreenParams.zw - 1.0) * _OutlineWidth, 0, 0) + positionCS;
        //ç®—çš„ä¸ä¸€å®šå¯¹ï¼Œä¸è¿‡ä¹Ÿå¤§å·®ä¸å·®äº†ã€‚ã€‚
        float lengthRadius = _OutlineWidth * length(pointOffsetX * (_ScreenParams.zw - 1.0));
        output.positionCS = newClipPos;
        //å¦‚æœä¸ä¹˜ä¸Šæ·±åº¦çš„è¯ï¼Œä¼šæœ‰é€è§†å˜å½¢çš„é—®é¢˜
        //https://en.wikipedia.org/wiki/Texture_mapping#Affine_texture_mapping
        output.uv = vertexUVs[vertexID] * (-newClipPos.w);
        output.ratio = 2.0 * lengthRadius / (2.0 * lengthRadius + lengthOffset);
        return output;
    }

    float GetDist(float2 uv, float ratio)
    {
        uv.x = 0.5 - abs(0.5 - uv.x);
        float2 coord = float2(uv.x * rcp(ratio), uv.y);
        float2 center = float2(0.5, 0.5);
        float distToCenter = length(coord - center);
        float distToLine = abs(uv.y - 0.5);

        return coord.x &lt; 0.5 ? distToCenter : distToLine;
    }

    float4 Frag(Varyings input) : SV_TARGET
    {
        float2 uv = input.uv / (-input.positionCS.w);
        float distValue = GetDist(uv, input.ratio);
        //ç”¨smoothstepè¿›è¡ŒæŠ—é”¯é½¿
        distValue = smoothstep(0.5, _Sharpness * 0.5, distValue);

        return float4(_OutlineColor.rgb, distValue * _OutlineColor.a);
    }

    ENDHLSL

    SubShader
    {
        Tags {&quot;Queue&quot;=&quot;Transparent&quot; &quot;RenderType&quot;=&quot;Transparent&quot; }
        ZWrite Off
        Blend SrcAlpha OneMinusSrcAlpha
        
        Pass
        {
            HLSLPROGRAM
            #pragma vertex Vert
            #pragma fragment Frag
            ENDHLSL
        }
    }
}
</code></pre><h2 id=ç»“è¯­>ç»“è¯­<a hidden class=anchor aria-hidden=true href=#ç»“è¯­>#</a></h2><p>æˆ‘å¯¹ç›®å‰çš„æ•ˆæœè¿˜æ˜¯å¾ˆæ»¡æ„çš„ï¼ä¹Ÿæ²¡çœ‹åˆ°æœ‰ä»€ä¹ˆäººåšè¿™ä¸ªç”»çº¿çš„æ“ä½œï¼ˆé™¤äº†Shapesï¼Œå½“ç„¶æˆ‘ä¹Ÿæ²¡å»æœç´¢åˆ«çš„æ¡ˆä¾‹å°±æ˜¯äº†ï¼‰ã€‚æ„Ÿè§‰å¯¹ç»˜åˆ¶é¡¶ç‚¹æ—¶çš„å¤„ç†å’Œç©ºé—´å˜æ¢çš„ç†è§£åˆå¤§å¤§åŠ æ·±äº†ï¼ä¸‹ä¸€ä¸ªç›®æ ‡å°±æ˜¯æè¾¹çš„è®¡ç®—äº†ï¼Œç›®å‰æ„Ÿè§‰ä¸Šä¼šå’ŒåŸå§‹æ¨¡å‹æœ‰æ·±åº¦æµ‹è¯•çš„é—®é¢˜ï¼Œåªèƒ½èµ°ä¸€æ­¥çœ‹ä¸€æ­¥äº†ã€‚</p><p>è¿™æ®µæ—¶é—´ä¸€ç›´åœ¨æ€è€ƒæ™¯æ·±å’Œå†™ShaderToyï¼Œä¹Ÿç®—æ”¶è·ä¸å°‘ï¼Œä¸è¿‡æ²¡èƒ½å†™å‡ºåšå®¢æ¥ï¼Œæ‹¿è¿™ä¸ªç­‰å®½ä¸”æŠ—é”¯é½¿çš„ä¸–ç•Œåæ ‡ç›´çº¿æ¥å¼¥è¡¥ä¸€ä¸‹ã€‚</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://zznewclear13.github.io/tags/space-transformation/>Space Transformation</a></li><li><a href=https://zznewclear13.github.io/tags/anti-aliasing/>Anti-Aliasing</a></li></ul><nav class=paginav><a class=prev href=https://zznewclear13.github.io/posts/draw-equal-width-outline-in-unity/><span class=title>Â« Prev</span><br><span>åœ¨Unityä¸­ç»˜åˆ¶ç­‰å®½çš„æè¾¹</span></a>
<a class=next href=https://zznewclear13.github.io/posts/gpu-color-inspector/><span class=title>Next Â»</span><br><span>GPUé¢œè‰²æŸ¥çœ‹å™¨</span></a></nav></footer><div id=comments></div><script>let currentHugoTheme=window.localStorage.getItem("pref-theme");function loadComment(){const b=document.getElementById('comments');let c=currentHugoTheme=='dark'?'photon-dark':'github-light',a=document.createElement('script');a.src='https://utteranc.es/client.js',a.setAttribute('repo','zznewclear13/zznewclear13.github.io'),a.setAttribute('issue-term','pathname'),a.setAttribute('label','utterances'),a.setAttribute('theme',c),a.setAttribute('crossorigin','anonymous'),a.setAttribute('async',''),b.innerHTML='',b.appendChild(a)}loadComment(),document.getElementById('theme-toggle').onclick=async()=>{await new Promise(a=>setTimeout(a,200));let a=window.localStorage.getItem('pref-theme');a!=currentHugoTheme&&(currentHugoTheme=a,loadComment())}</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://zznewclear13.github.io/>ZZNEWCLEAR13</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>